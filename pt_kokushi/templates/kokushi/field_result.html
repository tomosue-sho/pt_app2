{% extends "base.html" %}

{% block content %}
<style>
    table {
        width: 100%;
        border-collapse: collapse;
    }
    
    th, td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    
    th {
        background-color: #f2f2f2;
    }
    
    tr:hover {
        background-color: #f5f5f5;
    }
</style>    
<h2>{{ exam.year }}回 国家試験の分野ごとの正答率</h2>

<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>分野</th>
            <th>問題数</th>
            <th>正答数</th>
            <th>正答率 (%)</th>
        </tr>
    </thead>
    <tbody>
        {% for result in field_accuracy %}
        <tr>
            <td>{{ result.question__field__name }}</td>
            <td>{{ result.total }}</td>
            <td>{{ result.correct_sum }}</td>
            <td>{{ result.accuracy|floatformat:2 }}</td>
            <td>
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: {{ result.accuracy }}%;" aria-valuenow="{{ result.accuracy }}" aria-valuemin="0" aria-valuemax="100">{{ result.accuracy|floatformat:2 }}%</div>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<canvas id="fieldAccuracyChart" width="400" height="400"></canvas>

<p><a href="{% url 'pt_kokushi:kokushi_results' %}" class="btn btn-secondary">成績に戻る</a></p>
<p><a href="{% url 'pt_kokushi:top' %}" class="btn btn-secondary">トップに戻る</a></p>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    function getRandomColor() {
        var r = Math.floor(Math.random() * 256); // 0-255
        var g = Math.floor(Math.random() * 256); // 0-255
        var b = Math.floor(Math.random() * 256); // 0-255
        return 'rgba(' + r + ', ' + g + ', ' + b + ', 0.7)'; // 透明度0.7で色を生成
    }
    
    // データセットのデータ
    var data = {{ percentages|safe }};
    
    // データセットのデータに対応する背景色の配列を生成
    var backgroundColors = data.map(function() {
        return getRandomColor(); // 各データポイントに対してランダムな色を生成
    });
    
    var ctx = document.getElementById('fieldAccuracyChart').getContext('2d');
    var fieldAccuracyChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: {{ labels|safe }},
            datasets: [{
                data: data,
                backgroundColor: backgroundColors,
                borderColor: 'rgba(255, 255, 255, 1)', // 境界線色を白に設定
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            legend: {
                position: 'top',
            },
            title: {
                display: true,
                text: '{{ exam.year }}回 国家試験の分野ごとの正答率'
            }
        }
    });
    </script>
    
{% endblock %}
