{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
  .quiz-button {
    margin-bottom: 10px; /* 選択肢間の間隔を調整 */
    border: 1px solid #ddd; /* 枠線を細くして目立たなくする */
    background-color: #f8f8f8; /* 背景色を薄くする */
    border-radius: 5px; /* 角を丸くする */
    cursor: pointer; /* カーソルをポインターにする */
  }

  .quiz-button:hover {
    background-color: #e9ecef; /* ホバー時の背景色 */
  }

  /* ラジオボタンを隠す */
  .quiz-button input[type="radio"] {
    display: none;
  }

  /* ラジオボタンが選択されたときのスタイル */
  .quiz-button input[type="radio"]:checked + span {
    background-color: #ccc; /* 選択されたときの背景色 */
  }
</style>

<main class="quiz outer-block">
  <div class="inner-block">
    <div class="quiz-content">
      <div class="quiz-question-number"></div>
      <h2 class="quiz-question">{{ question.question_text }}</h2>
      <div class="quiz-answer row">
<!-- HTML部分の修正例 -->
      {% for choice_id, choice_text in choices %}
       <div class="col-md-6">
         <label class="quiz-button d-block p-2" id="label{{ choice_id }}">
         <input type="radio" name="radio" id="choice{{ choice_id }}" value="{{ choice_id }}" class="d-none" onclick="submitAnswer(event, {{ question.id }}, '{{ choice_id }}', 'label{{ choice_id }}')">
         <span onclick="event.stopPropagation()">{{ choice_text }}</span>
         </label>
       </div>
      {% endfor %}

      </div>      
    </div>
  </div>
</main>

<!-- カスタムポップアップのHTML -->
<div id="customPopup" 
style="display:none; 
       font-weight:bold;
       position:absolute; 
       background-color:#EEFFFF; 
       padding:20px; 
       border:1px solid #ccc; 
       border-radius:5px; 
       box-shadow:0 2px 5px rgba(0,0,0,0.2);
">
  <p id="popupMessage"></p>
</div>

<script>
function showCustomPopup(message, element) {
  var popup = document.getElementById('customPopup');
  popup.style.display = 'block';
  popup.innerHTML = message;

  // 選択肢の位置を取得
  var rect = element.getBoundingClientRect();

  // ポップアップの位置を選択肢の上に設定
  popup.style.top = rect.top + window.scrollY - popup.offsetHeight - 10 + 'px';
  popup.style.left = rect.left + window.scrollX + 'px';

  // ポップアップを1秒後に閉じる
  setTimeout(function() {
    popup.style.display = 'none';
  }, 1000);
}

function submitAnswer(event, questionId, selectedChoice, labelId) {
  event.stopPropagation(); // イベントの伝播を停止
  var selectedLabel = document.getElementById(labelId);

  fetch('{% url 'pt_kokushi:submit_answer' %}', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': '{{ csrf_token }}'
    },
    body: JSON.stringify({
      question_id: questionId,
      selected_answer: selectedChoice
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.is_correct) {
      showCustomPopup("正解！", selectedLabel);
    } else {
      showCustomPopup("不正解！", selectedLabel);
    }
  })
  .catch(error => console.error('Error:', error));
}
</script>


{% endblock %}
