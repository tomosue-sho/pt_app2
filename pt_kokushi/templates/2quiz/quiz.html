{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
  .quiz-button {
    margin-bottom: 10px; /* 選択肢間の間隔を調整 */
    border: 1px solid #ddd; /* 枠線を細くして目立たなくする */
    background-color: #f8f8f8; /* 背景色を薄くする */
    border-radius: 5px; /* 角を丸くする */
    cursor: pointer; /* カーソルをポインターにする */
  }

  .quiz-button:hover {
    background-color: #e9ecef; /* ホバー時の背景色 */
  }

  /* ラジオボタンを隠す */
  .quiz-button input[type="radio"] {
    display: none;
  }

  /* ラジオボタンが選択されたときのスタイル */
  .quiz-button input[type="radio"]:checked + span {
    background-color: #ccc; /* 選択されたときの背景色 */
  }
</style>
<main class="quiz outer-block">
  <div class="inner-block">
    <div class="quiz-content">
      <div class="quiz-question-number"></div>
      <h2 class="quiz-question">{{ question.question_text }}</h2>
      <div class="quiz-answer row">
        {% for choice in choices %}
          <div class="col-md-6">
            <label class="quiz-button d-block p-2" onclick="submitAnswer(event, {{ question.id }}, '{{ forloop.counter }}')">
              <input type="radio" name="radio" id="choice{{ forloop.counter }}" value="{{ forloop.counter }}" class="d-none" onclick="stopPropagation(event)">
              <span onclick="stopPropagation(event)">{{ choice }}</span>
            </label>
          </div>
        {% endfor %}
      </div>      
    </div>
  </div>
</main>

<script>
  function submitAnswer(event, questionId, selectedChoice) {
    // イベントの伝播を停止
    event.stopPropagation(); 

    fetch('{% url 'pt_kokushi:submit_answer' %}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}'
      },
      body: JSON.stringify({
        question_id: questionId,
        selected_answer: selectedChoice
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.is_correct) {
        alert("正解！");
      } else {
        alert("不正解！");
      }
    })
    .catch(error => console.error('Error:', error));
  }
  function stopPropagation(event) {
    event.stopPropagation();
  }
</script>
{% endblock %}
