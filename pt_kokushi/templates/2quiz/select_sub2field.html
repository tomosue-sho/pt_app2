{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .subfield-title {
        padding: 0.5em;
        color: #494949;
        background: #fffaf4;
        border-left: solid 5px #ffaf58;
    }
</style>
<div class="container mt-3">
    <h1 class="mb-4">{{ subfield.name }}の補足詳細の分野を選択してください</h1>
    <ul class="list-group">
        {% for sub2field in sub2fields %}
            <li class="list-group-item">
                <div>
                    <h5 class="subfield-title">{{ sub2field.name }}</h5>
                    <p>{{ sub2field.description }}</p>
                </div>
                <form method="post" action="{% url 'pt_kokushi:quiz_sub2field' sub2field.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="sub2field_id" value="{{ sub2field.id }}">
                    <button type="submit" id="start-quiz-btn" class="btn btn-primary">クイズを開始する</button>
                </form>                                            
            </li>
        {% endfor %}
    </ul>
</div>
<br>
<p><a href="{% url 'pt_kokushi:select_subfield' subfield.field.id %}" class="btn btn-secondary">詳細選択へ戻る</a></p>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var resetQuizCountUrl = "{% url 'pt_kokushi:reset_quiz_count' %}"; // DjangoのURL逆引きを使用
        document.getElementById('start-quiz-btn').addEventListener('click', function() {
            // Ajaxリクエストを送信してクイズ関連のセッション変数をリセット
            fetch(resetQuizCountUrl, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',  // CSRFトークンをヘッダーに含める
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ startQuiz: true })
            })
            .then(response => {
                if (response.ok) {
                    console.log('クイズの初期化に成功しました。');
                } else {
                    console.error('クイズの初期化に失敗しました。');
                }
            });
        });
    });
    </script>
    
        
    
{% endblock %}
