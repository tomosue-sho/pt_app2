{% extends 'base.html' %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<canvas id="studyLogChart"></canvas>

<form method="post" action="{% url 'pt_kokushi:save_study_log' %}">
    {% csrf_token %}
    <div class="form-group">
        <label for="studyDate">学習日</label>
        <input type="date" class="form-control" id="studyDate" name="study_date" required value="{{ today }}">
    </div>
    <div class="form-group">
        <label for="studyDuration">学習時間（分）</label>
        <input type="number" class="form-control" id="studyDuration" name="study_duration" required>
    </div>
    <div class="form-group">
        <label for="studyContent">学習内容</label>
        <textarea class="form-control" id="studyContent" name="study_content" rows="3" required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">記録する</button>
</form>
<script>
    var ctx = document.getElementById('studyLogChart').getContext('2d');
    var studyLogChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['月', '火', '水', '木', '金', '土', '日'], // 横軸を曜日表示に変更
            datasets: [{
                label: '学習時間（時間）',
                data: [1.5, 2, 2.5, 3, 1, 4, 3.5], // 学習時間のデータ（時間単位）
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    max: 12, // Y軸の最大値を12に設定
                    ticks: {
                        stepSize: 1, // 1単位ごとにメモリを表示
                        // ラベルをカスタマイズして整数の時間表示にする
                        callback: function(value, index, values) {
                            return value + '時間';
                        }
                    }
                }
            }
        }
        
    });
    
    document.addEventListener('DOMContentLoaded', function() {
        var today = new Date().toISOString().split('T')[0];  // 現在の日付を 'YYYY-MM-DD' 形式で取得
        document.getElementById('studyDate').value = today;  // 入力フィールドに設定
    });

    fetch('/api/study-log-data/')  // APIのURLに置き換える
    .then(response => response.json())
    .then(data => {
        // チャートのデータを更新
        studyLogChart.data.labels = data.map(log => log.study_date);  // 学習日をラベルに設定
        studyLogChart.data.datasets[0].data = data.map(log => log.study_duration);  // 学習時間をデータに設定
        studyLogChart.update();  // チャートを更新
    })
    .catch(error => console.error('Error fetching data:', error));
</script>
    

{% endblock %}